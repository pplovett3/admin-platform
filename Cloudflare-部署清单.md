# â˜ï¸ Cloudflare Tunnel éƒ¨ç½²æ¸…å•

## ğŸ“‹ ç¬¬ä¸€æ­¥ï¼šCloudflare æ§åˆ¶å°é…ç½®

ç™»å½• [Cloudflare Zero Trust](https://one.dash.cloudflare.com/)ï¼Œé…ç½®ä¸¤ä¸ªåŸŸåè·¯ç”±ï¼š

### âœ… å”¯ä¸€è·¯ç”±ï¼šç»Ÿä¸€å…¥å£ï¼ˆNginxï¼‰

| é…ç½®é¡¹ | å€¼ |
|--------|-----|
| Subdomain | `platform` |
| Domain | `yf-xr.com` |
| Service Type | `HTTP` |
| URL | `192.168.0.239:3001` |

**å®Œæ•´åŸŸå**ï¼š`platform.yf-xr.com` â†’ `http://192.168.0.239:3001`

**è¯´æ˜**ï¼š
- âœ… åªéœ€é…ç½®ä¸€ä¸ªåŸŸåè·¯ç”±
- âœ… Nginx è‡ªåŠ¨å°† `/api/*` è½¬å‘åˆ°åç«¯
- âœ… å‰ç«¯å’Œåç«¯ç»Ÿä¸€å…¥å£ï¼Œæ—  Mixed Content é—®é¢˜
- âœ… æ”¯æŒ HTTP/HTTPS è‡ªåŠ¨é€‚é…

---

## ğŸ“‚ ç¬¬äºŒæ­¥ï¼šå¤åˆ¶æ–‡ä»¶åˆ° NAS

ä½¿ç”¨æ–‡ä»¶èµ„æºç®¡ç†å™¨ï¼ˆ`\\192.168.0.239\docker\admin-platform\`ï¼‰å¤åˆ¶ï¼š

### âœ… æ–‡ä»¶ 1: server/src/index.ts
```
ä»: E:\ä¸Šä¿¡æ ¡äº§çº¿åŠ¨ç”»\admin-platform\server\src\index.ts
åˆ°:  \\192.168.0.239\docker\admin-platform\server\src\index.ts
```

### âœ… æ–‡ä»¶ 2: docker-compose.nas.yml
```
ä»: E:\ä¸Šä¿¡æ ¡äº§çº¿åŠ¨ç”»\admin-platform\docker-compose.nas.yml
åˆ°:  \\192.168.0.239\docker\admin-platform\docker-compose.yml
```

---

## ğŸš€ ç¬¬ä¸‰æ­¥ï¼šSSH åˆ° NAS éƒ¨ç½²

### æ–¹æ³• 1ï¼šä½¿ç”¨è‡ªåŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
ssh Tyrael@192.168.0.239
cd /volume1/docker/admin-platform
bash Cloudflare-éƒ¨ç½²å‘½ä»¤.sh
```

---

### æ–¹æ³• 2ï¼šæ‰‹åŠ¨æ‰§è¡Œå‘½ä»¤

```bash
# 1. SSH ç™»å½•
ssh Tyrael@192.168.0.239

# 2. è¿›å…¥ç›®å½•
cd /volume1/docker/admin-platform

# 3. åœæ­¢æœåŠ¡
docker compose down

# 4. æ„å»ºå¹¶å¯åŠ¨æœåŠ¡ï¼ˆè‡ªåŠ¨æ„å»º ARM64 é•œåƒï¼‰
docker compose up -d --build

# 5. æŸ¥çœ‹æ—¥å¿—
docker compose logs -f
```

ç­‰å¾…çœ‹åˆ°ï¼š
```
admin-platform-server | Server listening on port 4000
```

æŒ‰ `Ctrl+C` é€€å‡ºæ—¥å¿—æŸ¥çœ‹ã€‚

---

## âœ… ç¬¬å››æ­¥ï¼šæµ‹è¯•éªŒè¯

### 1ï¸âƒ£ æµ‹è¯•åç«¯å¥åº·æ£€æŸ¥

æµè§ˆå™¨è®¿é—®æˆ–æ‰§è¡Œï¼š
```bash
curl https://api.platform.yf-xr.com/health
```

åº”è¿”å›ï¼š`{"ok":true}`

---

### 2ï¸âƒ£ æµ‹è¯•å‰ç«¯è®¿é—®

æµè§ˆå™¨è®¿é—®ï¼š
```
https://platform.yf-xr.com
```

åº”è¯¥èƒ½çœ‹åˆ°ç™»å½•é¡µé¢ï¼Œä¸”æµè§ˆå™¨åœ°å€æ æ˜¾ç¤º ğŸ”’ï¼ˆHTTPSï¼‰

---

### 3ï¸âƒ£ æµ‹è¯•ç™»å½•

- **æ‰‹æœºå·**ï¼š`13800000000`
- **å¯†ç **ï¼š`admin123`

èƒ½æ­£å¸¸ç™»å½•å¹¶è¿›å…¥ç®¡ç†åå° âœ…

---

### 4ï¸âƒ£ æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°

æŒ‰ `F12` æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼Œæ£€æŸ¥ï¼š

- âœ… æ—  Mixed Content é”™è¯¯
- âœ… æ—  CORS é”™è¯¯
- âœ… API è¯·æ±‚åœ°å€ä¸º `https://api.platform.yf-xr.com`

---

## ğŸ” å¸¸è§é—®é¢˜

### âŒ Mixed Content é”™è¯¯

**é—®é¢˜**ï¼šæµè§ˆå™¨é˜»æ­¢ HTTP è¯·æ±‚

**è§£å†³**ï¼š
1. ç¡®è®¤ `docker-compose.yml` ä¸­ `NEXT_PUBLIC_API_URL` ä¸º `https://api.platform.yf-xr.com`
2. é‡æ–°æ„å»º web é•œåƒæ—¶ï¼Œç¡®ä¿ä½¿ç”¨äº† `--build-arg`
3. é‡å¯æœåŠ¡

---

### âŒ CORS é”™è¯¯

**é—®é¢˜**ï¼šè·¨åŸŸè¯·æ±‚è¢«é˜»æ­¢

**è§£å†³**ï¼š
1. ç¡®è®¤ `server/src/index.ts` ä¸­å·²æ·»åŠ ä¸¤ä¸ªåŸŸååˆ° CORS ç™½åå•
2. é‡æ–°æ„å»º server é•œåƒ
3. é‡å¯æœåŠ¡

---

### âŒ 524 Timeout

**é—®é¢˜**ï¼šCloudflare è¿æ¥è¶…æ—¶

**è§£å†³**ï¼š
1. æ£€æŸ¥ NAS ä¸ŠæœåŠ¡æ˜¯å¦è¿è¡Œï¼š`docker compose ps`
2. æ£€æŸ¥ Cloudflare Tunnel çŠ¶æ€æ˜¯å¦ä¸º Healthy
3. å¢åŠ  Tunnel çš„è¿æ¥è¶…æ—¶æ—¶é—´

---

### âŒ 502 Bad Gateway

**é—®é¢˜**ï¼šæ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡

**è§£å†³**ï¼š
1. ç¡®è®¤æœåŠ¡æ­£åœ¨è¿è¡Œï¼š`docker compose ps`
2. ç¡®è®¤ Cloudflare Tunnel é…ç½®çš„ç«¯å£æ­£ç¡®ï¼ˆå‰ç«¯ 3001ï¼Œåç«¯ 4000ï¼‰
3. æŸ¥çœ‹æœåŠ¡æ—¥å¿—ï¼š`docker compose logs -f server`

---

## ğŸ“ è®¿é—®åœ°å€æ±‡æ€»

### ğŸŒ å…¬ç½‘è®¿é—®ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
- **å‰ç«¯ç®¡ç†åå°**ï¼šhttps://platform.yf-xr.com
- **åç«¯ API**ï¼šhttps://api.platform.yf-xr.com
- **å…¬å¼€è¯¾ç¨‹ç¤ºä¾‹**ï¼šhttps://platform.yf-xr.com/course/[è¯¾ç¨‹ID]

### ğŸ  å†…ç½‘è®¿é—®ï¼ˆå¼€å‘æµ‹è¯•ï¼‰
- **å‰ç«¯**ï¼šhttp://192.168.0.239:3001
- **åç«¯**ï¼šhttp://192.168.0.239:4000

### ğŸ‘¤ é»˜è®¤è´¦å·
- **æ‰‹æœºå·**ï¼š13800000000
- **å¯†ç **ï¼šadmin123

---

## ğŸ‰ éƒ¨ç½²å®Œæˆï¼

ç°åœ¨ä½ çš„ç³»ç»Ÿå·²ç»å¯ä»¥é€šè¿‡å…¬ç½‘å®‰å…¨è®¿é—®äº†ï¼

éœ€è¦å¸®åŠ©ï¼ŸæŸ¥çœ‹å®Œæ•´æ–‡æ¡£ï¼š`Cloudflare-Tunnel-éƒ¨ç½²æŒ‡å—.md`

