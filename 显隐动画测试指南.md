# 显隐动画GLB导出测试指南

## 🎯 测试目标
验证显隐关键帧是否正确写入GLB文件，并能在外部软件中正常播放。

## 📋 测试步骤

### 1. 创建纯显隐动画
1. 打开3D课件编辑器
2. 加载一个含有多个部件的模型
3. 创建新动画：点击"新建动画"
4. 选择一个模型部件
5. 在时间线不同位置添加显隐关键帧：
   - 0秒：点击"添加关键帧"（当前可见状态）
   - 2秒：拖动时间指示器到2秒，点击"设为隐藏"
   - 4秒：拖动时间指示器到4秒，点击"设为显示"
   - 6秒：拖动时间指示器到6秒，点击"设为隐藏"

### 2. 保存动画
1. 点击"保存动画"按钮
2. 观察控制台输出，确认：
   ```
   [Animation/Save] 保存动画: [动画ID]
     显隐轨道数量: 1
     [显隐轨道] [对象名]: 4个关键帧 0s:显示, 2s:隐藏, 4s:显示, 6s:隐藏
   ```

### 3. 保存课件到服务器
1. 点击"保存课件"按钮
2. 观察控制台输出，确认显隐轨道数据包含在保存数据中

### 4. 导出GLB文件
1. 点击右上角设置按钮旁的下拉菜单
2. 选择"导出GLB"
3. 观察控制台输出，应看到：
   ```
   🎯 [手动GLB导出] 当前动画状态:
     [显隐轨道] [对象名]: 4个关键帧 - 0s:显 2s:隐 4s:显 6s:隐
   
   🔄 转换自定义动画: [动画名]
     可见性轨道数量: 1
     ✅ 成功转换，生成轨道数量: 1
   
   [GLB导出动画 1] [动画名]:
     轨道总数: 1
     缩放轨道: 1
     缩放轨道 [对象名]: 4个关键帧 (可能为可见性映射)
   ```

### 5. Windows模型查看器测试
1. 找到下载的GLB文件
2. 右键 → "打开方式" → "3D查看器"（Windows 10/11内置）
3. 在查看器中：
   - 点击播放按钮
   - 观察动画播放过程中对象的显隐变化
   - 应该看到对象按照设定的时间点显示/隐藏

### 6. 可选：其他软件验证
- **Blender**: 导入GLB，查看动画轨道
- **Three.js编辑器**: 在线验证GLB动画
- **babylon.js查看器**: 在线GLB查看器

## 🔍 预期结果

### 控制台日志关键指标
✅ **添加关键帧时**:
```
[Visibility/AddKey] 对象: [对象名], 时间: [时间]s, 可见性: [true/false], 轨道关键帧数: [数量]
```

✅ **转换为GLB动画时**:
```
👁️ 处理可见性: [对象名] (4个关键帧)
✅ 已生成可见性→缩放轨道: [对象名].scale, 4个时间点
```

✅ **GLB轨道生成**:
- 缩放轨道包含极小值（1e-3）表示隐藏状态
- 缩放轨道包含正常值表示显示状态

### Windows查看器中的预期行为
- 动画播放时对象按时间点显示/隐藏
- 隐藏时对象完全消失（缩放为极小值）
- 显示时对象正常显示（恢复原始缩放）

## 🐛 故障排除

### 如果看不到显隐效果
1. 检查控制台是否有"可见性轨道数量: 0"
2. 确认选中对象后添加了关键帧
3. 检查时间线是否正确设置了不同的可见性状态
4. 验证GLB导出时是否包含缩放轨道

### 常见问题
- **对象没有隐藏**: 可能缩放值设置过大，检查是否使用了1e-3
- **动画不播放**: 检查Windows查看器是否支持该GLB版本
- **轨道缺失**: 确认显隐轨道数据在保存时没有丢失

## 📝 测试报告模板
```
测试日期: [日期]
模型文件: [文件名]
显隐对象: [对象名称]
关键帧设置: [0s:显示, 2s:隐藏, 4s:显示, 6s:隐藏]

控制台日志:
- [ ] 添加关键帧日志正常
- [ ] 动画保存日志正常  
- [ ] GLB转换日志正常
- [ ] 缩放轨道生成正常

Windows查看器测试:
- [ ] GLB文件可以打开
- [ ] 动画可以播放
- [ ] 显隐效果正确
- [ ] 时间点准确

结论: [通过/失败]
问题描述: [如有问题请详细描述]
```



