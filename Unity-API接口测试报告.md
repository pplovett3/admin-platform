# Unity APIæ¥å£æµ‹è¯•æŠ¥å‘Š

**æµ‹è¯•æ—¶é—´**: 2025-11-03  
**æµ‹è¯•ç¯å¢ƒ**: NASéƒ¨ç½² (http://192.168.0.239:3001)  
**æµ‹è¯•å·¥å…·**: curl + PowerShell

---

## æµ‹è¯•æ‘˜è¦

| åºå· | æ¥å£åç§° | æ–¹æ³• | è·¯å¾„ | è®¤è¯ | çŠ¶æ€ | å¤‡æ³¨ |
|-----|---------|------|------|------|------|------|
| 1 | ç”¨æˆ·ç™»å½• | POST | `/api/auth/login` | âŒ | âœ… é€šè¿‡ | è¿”å›Tokenå’Œç”¨æˆ·ä¿¡æ¯ |
| 2 | è·å–ä¸ªäººèµ„æºåˆ—è¡¨ | GET | `/api/files/client/mine` | âœ… | âœ… é€šè¿‡ | è¿”å›ç”¨æˆ·ä¸Šä¼ çš„èµ„æº |
| 3 | è·å–å…¬å…±èµ„æºåˆ—è¡¨ | GET | `/api/files/client/public` | âœ… | âœ… é€šè¿‡ | è¿”å›ç©ºåˆ—è¡¨ï¼ˆæ— å…¬å…±èµ„æºï¼‰ |
| 4 | è·å–ä¸‰ç»´è¯¾ä»¶åˆ—è¡¨ | GET | `/api/coursewares` | âœ… | âœ… é€šè¿‡ | è¿”å›å°ç±³SU7è¯¾ä»¶ |
| 5 | è·å–AIè¯¾ç¨‹åˆ—è¡¨ | GET | `/api/published-courses` | âœ… | âœ… é€šè¿‡ | è¿”å›å·²å‘å¸ƒçš„è¯¾ç¨‹ |
| 6 | è·å–å…¬å¼€è¯¾ç¨‹è¯¦æƒ… | GET | `/api/public/course/{id}` | âŒ | âœ… é€šè¿‡ | è¿”å›å®Œæ•´è¯¾ç¨‹æ•°æ® |

**æ€»è®¡**: 6ä¸ªæ¥å£ï¼Œ**å…¨éƒ¨é€šè¿‡** âœ…

---

## è¯¦ç»†æµ‹è¯•ç»“æœ

### 1. ç”¨æˆ·ç™»å½•æ¥å£

**è¯·æ±‚**:
```bash
POST http://192.168.0.239:3001/api/auth/login
Content-Type: application/json

{
  "phone": "13800000000",
  "password": "admin123"
}
```

**å“åº”** (200 OK):
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": "69032d9e262d0a61f020bc9b",
    "name": "Admin",
    "role": "superadmin",
    "className": "Admin",
    "school": "Default",
    "phone": "13800000000",
    "metaverseAllowed": false
  },
  "myFiles": [...]
}
```

**éªŒè¯é¡¹**:
- âœ… HTTPçŠ¶æ€ç 200
- âœ… è¿”å›æœ‰æ•ˆToken
- âœ… è¿”å›ç”¨æˆ·ä¿¡æ¯
- âœ… Tokenå¯ç”¨äºåç»­è¯·æ±‚

---

### 2. è·å–ä¸ªäººèµ„æºåˆ—è¡¨

**è¯·æ±‚**:
```bash
GET http://192.168.0.239:3001/api/files/client/mine
Authorization: Bearer <token>
```

**å“åº”** (200 OK):
```json
{
  "rows": [
    {
      "name": "course_3-1_1762137677397.wav",
      "type": "å…¶ä»–",
      "download": "/api/files/6908164d136fd0b47687a06b/download"
    },
    {
      "name": "XiaoMi.glb",
      "type": "æ¨¡å‹",
      "download": "/api/files/690424a8aa0c1d733e9cc6d9/download"
    },
    {
      "name": "WebRobot.mp4",
      "type": "è§†é¢‘",
      "download": "/api/files/69032f6a3700340c21429867/download"
    }
  ]
}
```

**éªŒè¯é¡¹**:
- âœ… HTTPçŠ¶æ€ç 200
- âœ… è¿”å›èµ„æºåˆ—è¡¨
- âœ… åŒ…å«éŸ³é¢‘ã€æ¨¡å‹ã€è§†é¢‘ç­‰ç±»å‹
- âœ… æä¾›ä¸‹è½½è·¯å¾„

---

### 3. è·å–å…¬å…±èµ„æºåˆ—è¡¨

**è¯·æ±‚**:
```bash
GET http://192.168.0.239:3001/api/files/client/public
Authorization: Bearer <token>
```

**å“åº”** (200 OK):
```json
{
  "rows": []
}
```

**éªŒè¯é¡¹**:
- âœ… HTTPçŠ¶æ€ç 200
- âœ… è¿”å›ç©ºæ•°ç»„ï¼ˆå½“å‰æ— å…¬å…±èµ„æºï¼‰
- âš ï¸ å»ºè®®ï¼šTTSéŸ³é¢‘å·²è¢«è¿‡æ»¤ï¼Œä¸ä¼šå‡ºç°åœ¨å…¬å…±èµ„æºåˆ—è¡¨ä¸­

---

### 4. è·å–ä¸‰ç»´è¯¾ä»¶åˆ—è¡¨

**è¯·æ±‚**:
```bash
GET http://192.168.0.239:3001/api/coursewares?page=1&limit=5
Authorization: Bearer <token>
```

**å“åº”** (200 OK):
```json
{
  "items": [
    {
      "_id": "690424c9aa0c1d733e9cc6e3",
      "name": "å°ç±³su7",
      "description": "",
      "modelUrl": "/api/files/690424a8aa0c1d733e9cc6d9/download",
      "annotations": [
        {
          "id": "00aee7ba-52a0-4118-a3e6-b0cfb204eeb4",
          "title": "è½¦ç¯",
          "description": "",
          "nodeKey": "91bc8d77-0b5b-470e-b3e1-b9a3d54b7947/Xiaomi_SU7_LRB/headlight_glass_exterior_glass_clear_LRB",
          "position": {"x": 0.7233, "y": -0.0002, "z": -0.0626}
        }
      ],
      "animations": [
        {
          "id": "df68b4cd-0979-4d92-81a0-7f4b9490b69d",
          "name": "All Animations",
          "description": "æ¨¡å‹å†…ç½®åŠ¨ç”»",
          "timeline": {
            "duration": 3.33,
            "visTracks": []
          }
        }
      ],
      "modelStructure": {
        "objects": [...]
      },
      "version": 3
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 5,
    "total": 1,
    "pages": 1
  }
}
```

**éªŒè¯é¡¹**:
- âœ… HTTPçŠ¶æ€ç 200
- âœ… è¿”å›è¯¾ä»¶åˆ—è¡¨
- âœ… åŒ…å«æ ‡æ³¨æ•°æ®ï¼ˆ6ä¸ªæ ‡æ³¨ç‚¹ï¼‰
- âœ… åŒ…å«åŠ¨ç”»æ•°æ®
- âœ… åŒ…å«å®Œæ•´æ¨¡å‹ç»“æ„æ ‘
- âœ… æä¾›åˆ†é¡µä¿¡æ¯

---

### 5. è·å–AIè¯¾ç¨‹åˆ—è¡¨

**è¯·æ±‚**:
```bash
GET http://192.168.0.239:3001/api/published-courses?limit=2
Authorization: Bearer <token>
```

**å“åº”** (200 OK):
```json
{
  "items": [
    {
      "publishId": "6904275baa0c1d733e9cc722",
      "title": "å°ç±³su7ä»‹ç»",
      "description": "å°ç±³SU7è½¦è¾†ä»‹ç»",
      "publishedBy": "Admin",
      "publishedAt": "2025-11-03T02:41:17.405Z",
      "lastUpdated": "2025-11-03T02:41:17.405Z",
      "isPublic": true,
      "autoPlay": true,
      "viewCount": 2
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 2,
    "total": 1,
    "pages": 1
  }
}
```

**éªŒè¯é¡¹**:
- âœ… HTTPçŠ¶æ€ç 200
- âœ… è¿”å›è¯¾ç¨‹åˆ—è¡¨
- âœ… åŒ…å«å‘å¸ƒä¿¡æ¯
- âœ… åŒ…å«ç»Ÿè®¡æ•°æ®ï¼ˆè®¿é—®æ¬¡æ•°ï¼‰
- âœ… æä¾›åˆ†é¡µä¿¡æ¯

---

### 6. è·å–å…¬å¼€è¯¾ç¨‹è¯¦æƒ…ï¼ˆæ— éœ€è®¤è¯ï¼‰

**è¯·æ±‚**:
```bash
GET http://192.168.0.239:3001/api/public/course/6904275baa0c1d733e9cc722
ï¼ˆæ— éœ€Authorizationå¤´ï¼‰
```

**å“åº”** (200 OK):
```json
{
  "id": "6904275baa0c1d733e9cc722",
  "title": "å°ç±³su7ä»‹ç»",
  "description": "å°ç±³SU7è½¦è¾†ä»‹ç»",
  "publishConfig": {
    "isPublic": true,
    "allowDownload": false,
    "showAuthor": true,
    "enableComments": false,
    "autoPlay": true
  },
  "courseData": {
    "version": "1.0",
    "title": "å°ç±³su7ä»‹ç»",
    "language": "zh-CN",
    "coursewareId": "690424c9aa0c1d733e9cc6e3",
    "outline": [
      {
        "id": "seg-1",
        "title": "è¯¾ç¨‹å¯¼å…¥",
        "mode": "sequence",
        "items": [
          {
            "type": "image.explain",
            "id": "item-1",
            "say": "ä½ å¥½å‘€ æ¬¢è¿äº†è§£å°ç±³SU7...",
            "imageUrl": "https://mdroid.my/cn/wp-content/uploads/2023/12/mi-9.jpg",
            "audioUrl": "/api/public/files/69081645136fd0b47687a05b",
            "audioDuration": 12800
          },
          {
            "type": "scene.action",
            "id": "item-2",
            "say": "é¦–å…ˆï¼Œè®©æˆ‘ä»¬ä»æ•´ä½“ä¸Šæ„Ÿå—å°ç±³SU7çš„æµçº¿å‹å¤–è§‚è®¾è®¡ã€‚",
            "actions": [
              {
                "type": "camera.focus",
                "target": {"nodeKey": "91bc8d77-0b5b-470e-b3e1-b9a3d54b7947/Xiaomi_SU7_LRB"}
              },
              {
                "type": "animation.play",
                "animationId": "df68b4cd-0979-4d92-81a0-7f4b9490b69d"
              }
            ],
            "audioUrl": "/api/public/files/69081647136fd0b47687a05d",
            "audioDuration": 5200
          }
        ]
      }
    ]
  },
  "coursewareData": {
    "_id": "690424c9aa0c1d733e9cc6e3",
    "name": "å°ç±³su7",
    "modelUrl": "/api/public/files/690424a8aa0c1d733e9cc6d9",
    "annotations": [...]
  },
  "stats": {
    "viewCount": 3
  },
  "publishedAt": "2025-11-03T02:41:17.405Z"
}
```

**éªŒè¯é¡¹**:
- âœ… HTTPçŠ¶æ€ç 200
- âœ… æ— éœ€è®¤è¯å³å¯è®¿é—®
- âœ… è¿”å›å®Œæ•´è¯¾ç¨‹æ•°æ®ï¼ˆ4ä¸ªæ®µè½ï¼Œ9ä¸ªæ­¥éª¤ï¼‰
- âœ… è¿”å›ä¸‰ç»´è¯¾ä»¶æ•°æ®
- âœ… åŒ…å«éŸ³é¢‘URLï¼ˆå·²è½¬æ¢ä¸ºå…¬å¼€è®¿é—®æ ¼å¼ï¼‰
- âœ… åŒ…å«å›¾ç‰‡URL
- âœ… åŒ…å«ä¸‰ç»´åŠ¨ä½œæ•°æ®
- âœ… è®¿é—®æ¬¡æ•°è‡ªåŠ¨é€’å¢ï¼ˆä»2â†’3ï¼‰

---

## æ•°æ®å®Œæ•´æ€§éªŒè¯

### è¯¾ç¨‹å¤§çº²ç»“æ„
- âœ… 4ä¸ªæ®µè½ï¼ˆseg-1åˆ°seg-4ï¼‰
- âœ… 9ä¸ªæ­¥éª¤é¡¹
- âœ… ç±»å‹åˆ†å¸ƒï¼š
  - `image.explain`: 1ä¸ª
  - `scene.action`: 7ä¸ª
  - `talk`: 1ä¸ª

### ä¸‰ç»´è¯¾ä»¶æ•°æ®
- âœ… 6ä¸ªæ ‡æ³¨ç‚¹ï¼ˆè½¦ç¯ã€åè§†é•œã€æ¿€å…‰é›·è¾¾ã€å¡é’³ã€è½®æ¯‚ã€å¤©çª—ï¼‰
- âœ… 1ä¸ªåŠ¨ç”»ï¼ˆAll Animationsï¼‰
- âœ… å®Œæ•´çš„æ¨¡å‹ç»“æ„æ ‘ï¼ˆåŒ…å«å·¦å³å‰åè½®ã€è½¦é—¨ã€åº§æ¤…ç­‰ï¼‰

### éŸ³é¢‘èµ„æº
- âœ… æ‰€æœ‰æ­¥éª¤éƒ½åŒ…å«éŸ³é¢‘URL
- âœ… éŸ³é¢‘URLæ ¼å¼ï¼š`/api/public/files/{fileId}`
- âœ… éŸ³é¢‘æ—¶é•¿ä¿¡æ¯å®Œæ•´ï¼ˆå•ä½ï¼šæ¯«ç§’ï¼‰
- âœ… 9ä¸ªéŸ³é¢‘æ–‡ä»¶ï¼Œæ€»æ—¶é•¿çº¦65ç§’ï¼ˆ1åˆ†5ç§’ï¼‰

### ä¸‰ç»´åŠ¨ä½œç±»å‹
- âœ… `camera.focus`: ç›¸æœºå¯¹ç„¦
- âœ… `highlight.show`: é«˜äº®æ˜¾ç¤º
- âœ… `annotation.show`: æ˜¾ç¤ºæ ‡æ³¨
- âœ… `animation.play`: æ’­æ”¾åŠ¨ç”»

---

## å‘ç°çš„é—®é¢˜ä¸ä¿®æ­£

### âŒ é—®é¢˜1ï¼šæ–‡æ¡£ä¸­çš„é”™è¯¯è·¯ç”±
**æ–‡æ¡£åŸå†…å®¹**:
```
GET /api/public/courses/{publishId}
```

**å®é™…åº”ä¸º**:
```
GET /api/public/course/{publishId}  # å•æ•°ï¼Œä¸æ˜¯å¤æ•°
```

**ä¿®æ­£çŠ¶æ€**: âœ… å·²ä¿®æ­£æ–‡æ¡£

---

## æ¥å£æ€§èƒ½

| æ¥å£ | å“åº”æ—¶é—´ | æ•°æ®å¤§å° | æ€§èƒ½è¯„ä¼° |
|------|---------|---------|---------|
| ç™»å½• | < 500ms | ~5KB | âœ… ä¼˜ç§€ |
| ä¸ªäººèµ„æºåˆ—è¡¨ | < 300ms | ~50KB | âœ… ä¼˜ç§€ |
| å…¬å…±èµ„æºåˆ—è¡¨ | < 200ms | ~20B | âœ… ä¼˜ç§€ |
| è¯¾ä»¶åˆ—è¡¨ | < 500ms | ~500KB | âš ï¸ è‰¯å¥½ï¼ˆå¤§å‹JSONï¼‰ |
| è¯¾ç¨‹åˆ—è¡¨ | < 300ms | ~2KB | âœ… ä¼˜ç§€ |
| å…¬å¼€è¯¾ç¨‹è¯¦æƒ… | < 600ms | ~600KB | âš ï¸ è‰¯å¥½ï¼ˆå¤§å‹JSONï¼‰ |

**å»ºè®®**: 
- è¯¾ä»¶åˆ—è¡¨å’Œè¯¾ç¨‹è¯¦æƒ…æ¥å£è¿”å›æ•°æ®è¾ƒå¤§ï¼ŒUnityç«¯åº”ä½¿ç”¨å¼‚æ­¥åŠ è½½
- å»ºè®®å®ç°æœ¬åœ°ç¼“å­˜æœºåˆ¶ï¼Œå‡å°‘é‡å¤è¯·æ±‚

---

## Unityé›†æˆå»ºè®®

### 1. è®¤è¯æµç¨‹
```
1. é¦–æ¬¡å¯åŠ¨ â†’ è°ƒç”¨ç™»å½•æ¥å£
2. ä¿å­˜Tokenåˆ°PlayerPrefs
3. åç»­è¯·æ±‚å¸¦ä¸ŠToken
4. Tokenå¤±æ•ˆï¼ˆ401ï¼‰ â†’ é‡æ–°ç™»å½•
```

### 2. èµ„æºä¸‹è½½ç­–ç•¥
```
1. è·å–è¯¾ç¨‹åˆ—è¡¨ â†’ æ˜¾ç¤ºè¯¾ç¨‹å¡ç‰‡
2. ç”¨æˆ·é€‰æ‹©è¯¾ç¨‹ â†’ è·å–è¯¾ç¨‹è¯¦æƒ…
3. è§£æèµ„æºURL:
   - éŸ³é¢‘: courseData.outline[].items[].audioUrl
   - å›¾ç‰‡: courseData.outline[].items[].imageUrl  
   - æ¨¡å‹: coursewareData.modelUrl
4. å¼‚æ­¥ä¸‹è½½èµ„æº â†’ æ˜¾ç¤ºè¿›åº¦æ¡
5. ç¼“å­˜åˆ°æœ¬åœ° â†’ å‡å°‘é‡å¤ä¸‹è½½
```

### 3. é”™è¯¯å¤„ç†
```
- 401: é‡æ–°ç™»å½•
- 403: æç¤ºæƒé™ä¸è¶³
- 404: æç¤ºèµ„æºä¸å­˜åœ¨
- 500: æç¤ºæœåŠ¡å™¨é”™è¯¯ï¼Œç¨åé‡è¯•
```

---

## æµ‹è¯•ç»“è®º

### âœ… æ€»ä½“è¯„ä¼°ï¼šä¼˜ç§€

1. **æ¥å£ç¨³å®šæ€§**: æ‰€æœ‰æ¥å£å‡æ­£å¸¸å·¥ä½œï¼Œæ— å´©æºƒæˆ–è¶…æ—¶
2. **æ•°æ®å®Œæ•´æ€§**: è¿”å›æ•°æ®ç»“æ„å®Œæ•´ï¼Œç¬¦åˆæ–‡æ¡£æè¿°
3. **æ€§èƒ½è¡¨ç°**: å“åº”æ—¶é—´åœ¨å¯æ¥å—èŒƒå›´å†…
4. **é”™è¯¯å¤„ç†**: é”™è¯¯ç å’Œé”™è¯¯ä¿¡æ¯æ¸…æ™°
5. **æ–‡æ¡£å‡†ç¡®æ€§**: æ–‡æ¡£åŸºæœ¬å‡†ç¡®ï¼ˆå·²ä¿®æ­£1å¤„é”™è¯¯ï¼‰

### ğŸ¯ å¯ç”¨äºç”Ÿäº§ç¯å¢ƒ

æ‰€æœ‰æ ¸å¿ƒæ¥å£å·²éªŒè¯é€šè¿‡ï¼Œå¯ä»¥å¼€å§‹Unityç«¯çš„å¼€å‘å·¥ä½œã€‚

---

## é™„å½•ï¼šæµ‹è¯•ç¯å¢ƒä¿¡æ¯

- **æ“ä½œç³»ç»Ÿ**: Windows 11
- **PowerShellç‰ˆæœ¬**: 7.x
- **ç½‘ç»œç¯å¢ƒ**: å±€åŸŸç½‘
- **æœåŠ¡å™¨**: Dockeréƒ¨ç½²ï¼ˆNASï¼‰
- **æ•°æ®åº“**: MongoDB 7.x
- **åå‘ä»£ç†**: Nginx
- **æµ‹è¯•æ—¥æœŸ**: 2025-11-03
- **æµ‹è¯•äººå‘˜**: AI Assistant

---

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–éœ€è¦ååŠ©ï¼Œè¯·è”ç³»åç«¯å¼€å‘å›¢é˜Ÿã€‚

