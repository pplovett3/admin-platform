# YF课程启动器测试指南

## 测试环境准备

### 1. 后端服务器

确保后端服务器运行在 `http://localhost:4000`（或配置的API地址）。

```bash
cd admin-platform/server
npm start
```

### 2. 测试数据准备

在管理平台准备以下测试数据：

**测试用户：**
- 手机号：13800000001
- 密码：123456
- 角色：学生

**测试课程：**
- 课程ID：记录下来用于配置
- 课程名称：测试课程1

**激活码：**
1. 在管理平台生成激活码
2. 用测试学生账号激活课程

### 3. 配置courses.json

在launcher目录创建测试配置：

```json
{
  "courses": [
    {
      "courseId": "你的课程ID",
      "appPath": "C:/Windows/System32/notepad.exe",
      "name": "测试课程"
    }
  ]
}
```

注：使用notepad.exe作为测试应用，它会接收命令行参数但不会验证。

## 功能测试

### 测试1：启动器启动

**步骤：**
```bash
cd admin-platform/launcher
npm run dev
```

**预期结果：**
- ✅ Webpack开发服务器启动成功
- ✅ Electron窗口打开
- ✅ 显示登录页面
- ✅ 页面样式正常

**验证点：**
- 窗口标题显示"YF课程启动器"
- 登录表单完整显示
- 输入框有图标
- 按钮样式正常

---

### 测试2：登录功能

#### 2.1 错误处理

**步骤：**
1. 输入错误手机号：12345
2. 点击登录

**预期结果：**
- ✅ 显示"请输入有效的11位手机号"错误提示

**步骤：**
1. 输入正确手机号：13800000001
2. 输入错误密码：wrong
3. 点击登录

**预期结果：**
- ✅ 显示登录失败提示
- ✅ 页面保持在登录页

#### 2.2 成功登录

**步骤：**
1. 输入手机号：13800000001
2. 输入密码：123456
3. 点击登录

**预期结果：**
- ✅ 显示"登录成功！"提示
- ✅ 跳转到课程列表页
- ✅ localStorage中保存了token和user信息

**验证方法：**
打开开发者工具（F12） → Application → Local Storage：
```
token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
user: {"id":"...","name":"测试用户",...}
```

---

### 测试3：课程列表展示

**前提：** 已登录，且用户已激活至少一个课程

**步骤：**
1. 登录后自动显示课程列表页

**预期结果：**
- ✅ 顶部显示用户信息（头像、姓名、手机号）
- ✅ 显示"退出登录"按钮
- ✅ 显示"我的课程"标题
- ✅ 显示课程卡片网格

**课程卡片验证：**
- ✅ 显示课程封面（渐变色背景）
- ✅ 显示课程名称
- ✅ 显示激活有效期
- ✅ 显示"启动课程"按钮

**无课程情况：**
如果用户未激活任何课程：
- ✅ 显示"暂无已激活的课程"提示

---

### 测试4：退出登录

**步骤：**
1. 在课程列表页点击"退出登录"按钮

**预期结果：**
- ✅ 显示"已退出登录"提示
- ✅ 跳转回登录页
- ✅ localStorage中的token和user被清除

---

### 测试5：课程启动（核心功能）

#### 5.1 正常启动流程

**步骤：**
1. 确保courses.json中配置了课程
2. 在课程列表页点击"启动课程"按钮

**预期结果：**
- ✅ 按钮显示加载状态
- ✅ 调用验证API（/api/activation/verify）
- ✅ 验证通过后调用IPC启动应用
- ✅ 显示"课程已启动！"提示
- ✅ 应用程序启动（如果用notepad.exe，记事本会打开）

**验证令牌传递：**
如果使用测试应用，可以在主进程日志中看到：
```
Launching app: C:/Windows/System32/notepad.exe
Token: eyJhbGciOiJIUzI1NiIsInR...
App launched successfully
```

#### 5.2 课程未配置

**步骤：**
1. 从courses.json中删除courseId配置
2. 点击"启动课程"按钮

**预期结果：**
- ✅ 显示错误提示："未找到课程xxx的配置信息"

#### 5.3 应用路径不存在

**步骤：**
1. 在courses.json中配置不存在的路径
   ```json
   "appPath": "C:/NotExist/App.exe"
   ```
2. 点击"启动课程"按钮

**预期结果：**
- ✅ 显示错误提示："应用不存在: C:/NotExist/App.exe"

#### 5.4 课程已过期

**步骤：**
1. 在数据库中修改激活记录的expiresAt为过去时间
2. 刷新课程列表
3. 尝试启动课程

**预期结果：**
- ✅ "启动课程"按钮禁用
- ✅ 显示"已过期"标签

---

### 测试6：Token验证（集成测试）

#### 6.1 创建测试Unity/UE5应用模拟器

创建一个简单的C#控制台应用：

```csharp
// TokenTest.cs
using System;

class Program
{
    static void Main(string[] args)
    {
        Console.WriteLine("=== Token Test App ===");
        Console.WriteLine($"参数数量: {args.Length}");
        
        foreach (string arg in args)
        {
            Console.WriteLine($"参数: {arg}");
            
            if (arg.StartsWith("--token="))
            {
                string token = arg.Substring(8);
                Console.WriteLine($"Token长度: {token.Length}");
                Console.WriteLine($"Token前缀: {token.Substring(0, Math.Min(20, token.Length))}...");
                
                // 简单验证JWT格式
                string[] parts = token.Split('.');
                if (parts.Length == 3)
                {
                    Console.WriteLine("✅ Token格式有效（三段式JWT）");
                }
                else
                {
                    Console.WriteLine("❌ Token格式无效");
                }
            }
        }
        
        Console.WriteLine("按任意键退出...");
        Console.ReadKey();
    }
}
```

编译并配置到courses.json：
```json
{
  "courses": [
    {
      "courseId": "你的课程ID",
      "appPath": "C:/path/to/TokenTest.exe",
      "name": "Token测试应用"
    }
  ]
}
```

**验证步骤：**
1. 启动launcher并登录
2. 点击启动课程
3. 观察TokenTest应用输出

**预期输出：**
```
=== Token Test App ===
参数数量: 1
参数: --token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
Token长度: 200+
Token前缀: eyJhbGciOiJIUzI1NiIs...
✅ Token格式有效（三段式JWT）
按任意键退出...
```

---

## 性能测试

### 测试7：响应速度

**步骤：**
1. 测量登录响应时间
2. 测量课程列表加载时间
3. 测量应用启动时间

**预期结果：**
- ✅ 登录：< 2秒
- ✅ 课程列表加载：< 1秒
- ✅ 应用启动：< 3秒

---

## 错误处理测试

### 测试8：网络异常

**步骤：**
1. 停止后端服务器
2. 尝试登录

**预期结果：**
- ✅ 显示友好的错误提示："网络连接失败，请检查网络设置"

### 测试9：Token过期

**步骤：**
1. 修改localStorage中的token为过期的token
2. 尝试获取课程列表

**预期结果：**
- ✅ API调用失败
- ✅ 显示授权错误提示

---

## 兼容性测试

### 测试10：多分辨率

**测试分辨率：**
- 1920x1080
- 1366x768
- 1280x720

**预期结果：**
- ✅ 所有分辨率下布局正常
- ✅ 课程卡片自适应排列
- ✅ 文字不被截断

---

## 安全测试

### 测试11：直接启动应用（绕过launcher）

**步骤：**
1. 双击课程应用exe文件（不通过launcher）

**预期结果：**
- ✅ 如果应用正确集成了验证逻辑，应该立即退出
- ✅ 应用日志显示"缺少必需参数：--token"

### 测试12：Token篡改

**步骤：**
1. 启动课程时拦截Token
2. 修改Token内容
3. 手动用修改后的Token启动应用

**预期结果：**
- ✅ 应用验证Token失败并退出（如果实现了完整验证）

---

## 打包测试

### 测试13：打包安装程序

**步骤：**
```bash
npm run package:win
```

**预期结果：**
- ✅ 编译成功
- ✅ 生成安装程序：release/YF课程启动器 Setup X.X.X.exe
- ✅ 文件大小合理（< 200MB）

### 测试14：安装与卸载

**步骤：**
1. 运行安装程序
2. 完成安装
3. 从开始菜单启动
4. 通过控制面板卸载

**预期结果：**
- ✅ 安装过程顺畅
- ✅ 可选择安装目录
- ✅ 创建桌面快捷方式
- ✅ 启动正常
- ✅ 卸载干净

---

## 测试检查清单

使用此清单确保所有功能测试完成：

- [ ] 启动器正常启动
- [ ] 登录表单验证正确
- [ ] 登录成功并保存Token
- [ ] 课程列表正确显示
- [ ] 退出登录功能正常
- [ ] 课程启动功能正常
- [ ] Token正确传递给应用
- [ ] 错误处理友好
- [ ] 网络异常处理
- [ ] 多分辨率兼容
- [ ] 打包安装正常
- [ ] 应用可正常卸载

---

## 测试报告模板

```
测试时间：2024-XX-XX
测试人员：XXX
启动器版本：1.0.0

测试环境：
- 操作系统：Windows 10/11
- Node版本：v20.x
- 后端API：http://localhost:4000

测试结果汇总：
- 通过：XX项
- 失败：XX项
- 阻塞：XX项

详细结果：
[测试项] [结果] [备注]
登录功能 ✅ 正常
课程启动 ✅ 正常
Token传递 ✅ 正常
...

存在问题：
1. [问题描述]
   - 复现步骤
   - 预期结果
   - 实际结果

建议：
1. [改进建议]
```

---

## 自动化测试脚本

可以使用以下脚本进行基本的自动化测试：

```javascript
// test-launcher.js
const axios = require('axios');

const API_BASE = 'http://localhost:4000';

async function testAPI() {
  console.log('=== API测试 ===');
  
  // 测试登录
  try {
    const loginRes = await axios.post(`${API_BASE}/api/auth/login`, {
      phone: '13800000001',
      password: '123456'
    });
    console.log('✅ 登录成功');
    
    const token = loginRes.data.token;
    
    // 测试获取激活记录
    const activationsRes = await axios.get(`${API_BASE}/api/activation/user/activations`, {
      headers: { Authorization: `Bearer ${token}` }
    });
    console.log(`✅ 获取激活记录成功，共${activationsRes.data.length}条`);
    
  } catch (error) {
    console.error('❌ 测试失败:', error.message);
  }
}

testAPI();
```

运行：
```bash
node test-launcher.js
```

