# YF课程启动器集成脚本 - 简化版使用说明

## 📦 一个脚本，全部功能

`YFLauncherIntegration.cs` 整合了以下功能：
- ✅ Token接收和解析
- ✅ 用户信息验证
- ✅ 访问控制
- ✅ 简洁UI显示
- ✅ Editor测试支持

---

## 🚀 快速开始（3步）

### 第1步：创建场景
```
Unity → File → New Scene
保存为: MainScene
```

### 第2步：添加脚本
```
1. 创建空GameObject，命名: YFLauncher
2. 将 YFLauncherIntegration.cs 拖到上面
3. 完成！
```

### 第3步：测试
```
按 Play ▶️
```

---

## ⚙️ Inspector设置

### 调试设置
```
✅ Use Test Token In Editor
   在Editor中使用模拟Token
   → 看到欢迎消息

❌ Test Access Control In Editor
   在Editor中测试访问控制
   → 看到未授权退出
```

### 访问控制
```
Token Timeout: 3秒
   等待Token的超时时间

Exit Countdown: 5秒
   未授权时的退出倒计时
```

### UI设置
```
Welcome Duration: 1.5秒
   欢迎消息显示时长

Font Size: 32
   字体大小
```

---

## 🎮 运行效果

### ✅ 成功场景（收到Token）

```
┌────────────────────────────┐
│                            │
│         您好！              │
│                            │
│       测试学生001           │
│                            │
└────────────────────────────┘
```

**显示1.5秒后淡出，进入应用**

---

### ❌ 失败场景（未收到Token）

```
┌────────────────────────────┐
│                            │
│  ⚠️ 请使用启动器启动本应用  │
│                            │
│      应用即将关闭           │
│                            │
│           5                │
│                            │
│    请打开 YF课程启动器      │
│  登录后点击"启动课程"       │
│                            │
└────────────────────────────┘
```

**倒计时结束后自动退出**

---

## 🧪 测试模式

### Editor测试（模拟成功）

```
Inspector:
✅ Use Test Token In Editor
❌ Test Access Control In Editor

运行效果:
→ 显示"您好！测试学生001"
→ 1.5秒后消失
→ 应用继续运行
```

### Editor测试（模拟失败）

```
Inspector:
❌ Use Test Token In Editor
✅ Test Access Control In Editor

运行效果:
→ 显示"请使用启动器启动本应用"
→ 5秒倒计时
→ 场景自动停止
```

---

## 💻 在代码中使用

### 检查授权状态

```csharp
using UnityEngine;

public class MyGameScript : MonoBehaviour
{
    void Start()
    {
        // 检查是否已授权
        if (YFLauncherIntegration.Instance.IsAuthorized())
        {
            Debug.Log("✅ 已授权，允许访问");
            
            // 获取用户信息
            UserInfo user = YFLauncherIntegration.Instance.GetUserInfo();
            Debug.Log($"当前用户: {user.name}");
        }
        else
        {
            Debug.Log("❌ 未授权");
        }
    }
}
```

### 保存进度（需要授权）

```csharp
public class SaveSystem : MonoBehaviour
{
    public void SaveProgress()
    {
        if (!YFLauncherIntegration.Instance.IsAuthorized())
        {
            Debug.LogWarning("未授权：无法保存进度");
            return;
        }
        
        // 保存逻辑
        PlayerPrefs.SetInt("Level", currentLevel);
        Debug.Log("进度已保存");
    }
}
```

---

## 📝 Console日志输出

### 成功启动（有Token）
```
=== YF课程启动器集成 v1.0 ===
🔍 开始检查Token...
📦 接收到Token (长度: 215)
📄 JWT Payload: {"userId":"xxx","name":"测试学生001"...}
✅ 用户信息解析成功
   姓名: 测试学生001
   角色: 学生
✅ Token接收成功
👋 显示欢迎消息: 测试学生001
✅ 欢迎消息已关闭，进入应用
```

### 失败退出（无Token）
```
=== YF课程启动器集成 v1.0 ===
🔍 开始检查Token...
⚠️ 未检测到Token - 未授权访问
🚫 应用因未授权访问而退出
```

---

## 🎯 对比旧版本

| 功能 | 旧版（3个脚本） | 新版（1个脚本） |
|------|----------------|----------------|
| 脚本数量 | 3个 | 1个 ✅ |
| GameObject数量 | 3个 | 1个 ✅ |
| UI复杂度 | 复杂面板 | 简洁居中 ✅ |
| 配置难度 | 需要关联 | 即插即用 ✅ |
| 日志输出 | Console + UI | 仅Console ✅ |
| 代码行数 | ~450行 | ~350行 ✅ |

---

## ✅ 优点

1. **极简设计** - 一个脚本搞定所有
2. **易于使用** - 拖放即用，无需配置
3. **清晰反馈** - 成功/失败一目了然
4. **调试友好** - 支持Editor测试
5. **性能优化** - 自动淡出，无残留UI

---

## 🔧 自定义

### 修改欢迎文本

```csharp
// 第226行
messageText.text = $"欢迎回来，{userName}同学！";
```

### 修改退出文本

```csharp
// 第263行
messageText.text = "自定义的未授权消息";
```

### 修改UI样式

```csharp
// 第110行 - 背景颜色
panelImage.color = new Color(0, 0, 0, 0.9f); // 更深的背景

// 第127行 - 字体
messageText.font = yourCustomFont;
```

---

## 📦 完整文件清单

```
Unity测试脚本/
├── YFLauncherIntegration.cs     ← 唯一需要的脚本
├── 使用说明-简化版.md           ← 本文档
└── (旧版本脚本可以删除)
    ├── TokenReceiver.cs
    ├── LauncherAccessControl.cs
    └── TestSceneSetup.cs
```

---

## 🎓 最佳实践

1. **开发阶段**
   ```
   勾选 Use Test Token In Editor ✅
   快速测试功能
   ```

2. **测试访问控制**
   ```
   勾选 Test Access Control In Editor ✅
   验证未授权流程
   ```

3. **Build发布**
   ```
   保持默认设置即可
   通过启动器启动自动工作
   ```

4. **调整UI时长**
   ```
   Welcome Duration = 2.0   (更长的欢迎时间)
   Exit Countdown = 10      (更长的倒计时)
   ```

---

## 常见问题

### Q1: 欢迎消息一闪而过？
**A:** 增加 `Welcome Duration` 值，默认1.5秒。

### Q2: 想禁用访问控制？
**A:** 在代码第71行注释掉 `StartCoroutine(CheckTokenAndAuth());`

### Q3: 如何更改字体？
**A:** 将自定义字体放在 `Resources` 文件夹，修改第127行。

### Q4: 想要播放声音？
**A:** 在 `ShowWelcomeMessage()` 中添加 `AudioSource.PlayClipAtPoint()`

---

## 🚀 现在开始

1. ✅ 删除旧的3个脚本
2. ✅ 只用 `YFLauncherIntegration.cs`
3. ✅ 拖到场景中
4. ✅ 按Play测试
5. ✅ Build并通过启动器启动

完成！🎉

