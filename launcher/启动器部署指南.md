# YF课程启动器部署指南

## 开发环境运行

### 1. 安装依赖

```bash
cd admin-platform/launcher
npm install
```

### 2. 配置API地址

创建 `.env` 文件（可选）：

```
API_BASE=http://localhost:4000
```

如果不配置，默认使用 `http://localhost:4000`。

### 3. 启动开发服务器

```bash
npm run dev
```

这将：
1. 启动Webpack开发服务器（端口9000）
2. 启动Electron应用
3. 支持热重载

## 生产环境打包

### 1. 构建应用

```bash
npm run build
```

这将编译TypeScript和打包前端资源到 `dist/` 目录。

### 2. 打包Windows安装程序

```bash
npm run package:win
```

生成的文件：
- `release/YF课程启动器 Setup X.X.X.exe` - Windows安装程序

### 3. 安装程序特性

- NSIS安装向导
- 可选择安装目录
- 创建桌面快捷方式
- 创建开始菜单快捷方式
- 自动卸载功能

## 配置课程应用

### 1. 编辑courses.json

在启动器安装目录（或开发目录）创建/编辑 `courses.json`：

```json
{
  "courses": [
    {
      "courseId": "66b9abc123def456789",
      "appPath": "C:/YF/Courses/Course1/Course1.exe",
      "icon": "https://your-server.com/course-icon.png",
      "name": "示例课程"
    },
    {
      "courseId": "66b9xyz987ghi654321",
      "appPath": "D:/Programs/Course2/App.exe"
    }
  ]
}
```

**字段说明：**

| 字段 | 必填 | 说明 |
|------|------|------|
| courseId | 是 | 平台课程ID，必须与后端数据库中的课程_id匹配 |
| appPath | 是 | 课程应用可执行文件的完整路径 |
| icon | 否 | 课程图标URL（如不提供将使用默认图标） |
| name | 否 | 本地显示名称（平台课程名称会覆盖此字段） |

### 2. 支持的路径格式

```json
// 绝对路径（推荐）
"appPath": "C:/YF/Courses/MyCourse/MyCourse.exe"

// 相对路径（相对于启动器安装目录）
"appPath": "../Courses/MyCourse/MyCourse.exe"

// UNC路径
"appPath": "//server/share/Courses/MyCourse.exe"
```

### 3. 课程ID获取方式

1. 登录管理平台
2. 进入"课程管理"页面
3. 查看课程详情，复制课程ID
4. 或通过API获取：`GET /api/courses`

## 部署到客户端

### 方案1：统一安装包

1. 打包启动器
2. 在安装程序同目录放置 `courses.json`
3. 使用安装脚本批量部署：

```powershell
# deploy.ps1
# 安装启动器
Start-Process ".\YF课程启动器 Setup 1.0.0.exe" -Wait -ArgumentList "/S"

# 复制课程配置
Copy-Item ".\courses.json" -Destination "$env:LOCALAPPDATA\yf-course-launcher"

# 复制课程应用（可选）
Copy-Item -Recurse ".\Courses" -Destination "C:\YF\Courses"
```

### 方案2：网络配置

将courses.json放在网络共享位置，启动器读取网络配置：

```json
{
  "courses": [
    {
      "courseId": "xxx",
      "appPath": "//fileserver/courses/Course1/Course1.exe"
    }
  ]
}
```

### 方案3：动态配置（需要额外开发）

修改启动器从服务器API获取课程配置，无需手动维护courses.json。

## 更新与维护

### 更新启动器

1. 打包新版本
2. 安装新版本（会自动覆盖旧版本）
3. 配置文件会保留

### 更新课程配置

直接编辑 `courses.json`，重启启动器生效。

### 日志位置

- Windows: `%APPDATA%\yf-course-launcher\logs`
- 可通过Electron DevTools查看控制台日志

## 故障排查

### 问题1：启动器无法连接服务器

**症状：** 登录时提示网络错误

**解决：**
1. 检查后端服务器是否运行
2. 确认API_BASE配置正确
3. 检查防火墙设置
4. 测试网络连接：`curl http://your-api-server:4000/api/courses`

### 问题2：课程列表为空

**症状：** 登录后没有课程显示

**原因：**
- 用户未激活任何课程
- courses.json中的courseId不匹配

**解决：**
1. 在管理平台为用户分配激活码
2. 用户激活课程
3. 检查courses.json中的courseId是否正确

### 问题3：点击启动课程无反应

**症状：** 点击启动按钮后没有反应

**解决：**
1. 打开开发者工具查看错误
2. 检查courses.json中的appPath是否正确
3. 确认应用文件存在且可执行
4. 检查文件权限

### 问题4：应用启动后立即退出

**症状：** 课程应用闪退

**原因：**
- 应用未正确实现令牌验证
- 应用缺少依赖

**解决：**
1. 查看应用日志
2. 确认应用已集成令牌验证逻辑
3. 在命令行手动启动应用测试：
   ```bash
   Course.exe --token=test123
   ```
4. 检查应用依赖是否完整

## 安全注意事项

1. **Token安全**
   - Token通过命令行参数传递，有一定暴露风险
   - Token有效期7天，定期刷新
   - 不要在日志中明文记录完整Token

2. **配置文件权限**
   - courses.json包含应用路径信息
   - 建议设置适当的文件权限
   - 防止普通用户修改

3. **网络通信**
   - 生产环境使用HTTPS
   - 配置证书验证

## 技术支持

如遇问题，请提供：
1. 启动器版本
2. 操作系统版本
3. 错误截图/日志
4. 复现步骤

联系开发团队获取支持。

